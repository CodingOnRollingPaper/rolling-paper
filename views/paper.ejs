<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>My Paper</title>
    <link rel="stylesheet" href="/static/css/reset.css" />
    <link rel="stylesheet" href="/static/css/common.css" />
    <link rel="stylesheet" href="/static/css/paper.css" />
    <link rel="stylesheet" href="/static/css/snow.css" />
    <!-- axios cdn -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  </head>
  <body>
    <% if (userSession) { %>
    <form action="/logout" method="post">
      <button>LogOut</button>
    </form>
    <% } %>
    <div id="wrap">
      <div id="header">
        <canvas id="canvas"> </canvas>
        <h1><%= userName %>ë‹˜ì—ê²Œ ì˜¨ ë§ˆìŒ</h1>
        <div class="userId"><%= userId %></div>
        <!-- class='userId' display none ì²˜ë¦¬ ë¶€íƒí•©ë‹ˆë‹¤. => ì™„ë£Œ -->
      </div>
      <!-- í¸ì§€ ëª©ë¡ -->
      <div class="postArea">
        <% for (let i = 0; i < data.length; i++) { %>
        <div class="postContainer">
          <div class="postBox textArea">
            <div class="postId">ğŸ“© No. <%= data[i].dataValues.postId %></div>
            <div class="postContent"><%= data[i].dataValues.postContent %></div>
          </div>
        </div>
        <% } %>
      </div>

      <!-- í¸ì§€ ë””í…Œì¼ ëª¨ë‹¬ì°½ -->
      <div class="postContentModal">
        <% for (let i = 0; i < data.length; i++) { %>
        <div
          class="postContainerDetail noshow Id<%= data[i].dataValues.postId %>"
        >
          <div>
            <div class="closeDetail">X</div>
          </div>
          <div class="postBoxDetail">
            <div class="postIdDetail">
              ğŸ“© No. <%= data[i].dataValues.postId %> ë²ˆì§¸ ë§ˆìŒ
            </div>
            <div
              class="postContentDetail Content<%= data[i].dataValues.postId %>"
            >
              <%= data[i].dataValues.postContent %>
            </div>
          </div>

          <div class="postBtn Btn<%= data[i].dataValues.postId %>">

            <button onclick="editBtn('<%= data[i].dataValues.postId %>')">
              ìˆ˜ì •
            </button>
            <button onclick="deleteBtn()">ì‚­ì œ</button>
          </div>
        </div>
        <% } %>
      </div>

      <!-- í¸ì§€ ì‘ì„± ëª¨ë‹¬ì°½ -->
      <div class="writeContent noshow">
        <div class="close" onclick="show()">
          <div>X</div>
        </div>
        <div class="writeArea">
          ë‚¨ê¸°ê³  ì‹¶ì€ ë§
          <textarea
            class="submitContent"
            type="text"
            name="post"
            placeholder="ì „í•˜ê³  ì‹¶ì€ ë©”ì„¸ì§€ë¥¼ ì‘ì„±í•´ ì£¼ì„¸ìš”"
            required
          ></textarea>
          ë¹„ë°€ë²ˆí˜¸
          <input
            class="submitPw"
            type="password"
            name="postPw"
            placeholder="30ì ì´í•˜ë¡œ ì‘ì„±í•´ ì£¼ì„¸ìš”"
            required
          />
          <button class="submitGo" onclick="createPost()">ì…ë ¥</button>
        </div>
      </div>
      <% if (userSession && userSession.userName === userName) { %>
      <a>ê³µìœ í•˜ê¸°</a>
      <% } else { %>
      <!-- í¸ì§€ ì‘ì„± ëª¨ë‹¬ ë„ìš°ëŠ” ì´ë¯¸ì§€ ë²„íŠ¼ -->
      <div class="writeImg" onclick="show()">
        <img src="/static/img/writing.png" alt="ì‘ì„±í•˜ê¸°" />
      </div>
      <% } %>
    </div>
    <script>
      let submitGo = document.querySelector(".submitGo");
      let submitContent = document.querySelector(".submitContent");
      let submitPw = document.querySelector(".submitPw");
      let userId = document.querySelector(".userId").textContent;

      const createPost = () => {
        // ë¹ˆê°’ ìœ íš¨ì„± ê²€ì‚¬
        if (!submitContent.checkValidity()) {
          return submitContent.focus();
        } else if (!submitPw.checkValidity()) {
          return submitPw.focus();
        }
        console.log(submitContent.value, submitPw.value);
        axios({
          method: "post",
          url: "/post/create",
          data: {
            userId: userId,
            postContent: submitContent.value,
            postPw: submitPw.value,
          },
        }).then((res) => {
          //let contentBox = `<div class="postContainer">
          // <div class="postId">ê²Œì‹œ ë²ˆí˜¸ ${res.data.postId}</div>
          //  <div class="postContent">${res.data.postContent}</div>
          // <div class="postBtn id${res.data.postId}">
          //   <button onclick="editBtn(${res.data.postId})">ìˆ˜ì •</button>
          //  <button>ì‚­ì œ</button>
          // </div>
          let contentBox = `<div class="postContainer textArea">
              <div class="postId"> ğŸ“© No. ${res.data.postId}</div>
              <div class="postContent">${res.data.postContent}</div>
          </div>`;
          document
            .querySelector(".postArea")
            .insertAdjacentHTML("beforeend", contentBox);
        });
        submitContent.value = "";
        submitPw.value = "";
        writeContent.classList.add("noshow");
        postArea.classList.remove("noshow");
      };


      // let postBtn = document.querySelector(".postBtn");

      // let postContent = document.querySelector(".postContent");
      //  let postBtn = document.querySelector(".postBtn");

      // let postContainerDetail = document.querySelector(".postContainerDetail");
      let postBoxDetail = document.querySelector(".postBoxDetail");
      const editBtn = (id) => {
        let postContentDetail = document.querySelector(`.Content${id}`);
        let postNum = document.querySelector(`.Btn${id}`);
        console.log(id);
        console.log(postContentDetail.textContent.trim());
        console.log(postNum);
        console.log("edit!");
        // const editBox = `
        //     <input class="editPw" type="password" name="editPw">
        //     <button onclick="editPwCheck()">PW í™•ì¸</button>
        //  `;
        //  postNum.innerHTML = editBox;

        const editBox = `
          <div class="postBtn">
            <input class="editPw" type="password" name="editPw"></textarea>
            <button onclick="editPwCheck()">ë¹„ë°€ë²ˆí˜¸ í™•ì¸</button>
          </div>`;
        // <div class="postContent">${postContentDetail.textContent.trim()}</div> // pwë§ìœ¼ë©´ ì¶”ê°€ë  divíƒœê·¸
        // pwì ëŠ” ê³µê°„ textarea ì“´ ì´ìœ ,
        // pw ë¨¼ì € ì²´í¬í•˜ê³  ë³¸ë¬¸ ë°”ê¾¸ëŠ”ê²ƒì— ë³€í™” ì—†ëŠ”ì§€
        postNum.innerHTML = editBox;
      };

      const editPwCheck = (id) => {
        let editPw = document.querySelector(".editPw");
        let postNum = document.querySelector(`.id${id}`);
        console.log(editPw.value);
        axios({
          method: "POST",
          url: "/post/editPwCheck",
          data: {
            postPw: editPw.value,
          },
        })
          .then((res) => {
            console.log(res.data); // { postId: ?, postContent: ?, postPw: ?, userId: ? }
            let postContainerDetail = document.querySelector(
              `.Id${res.data.postId}`
            );
            let postContentDetail = document.querySelector(`.Content${id}`);
            const editInput = `
              <div>
                <div class="closeDetail">X</div>
              </div>
              <div class="postBoxDetail">
                <div class="postIdDetail">
                  ğŸ“© No. ${res.data.postId} ë²ˆì§¸ ë§ˆìŒ
                </div>
                <input type="text" value="${res.data.postContent}" onfocus
                  class="postContentDetail Content${res.data.postId}"
                >
              </div>
              <div class="postBtn Btn${res.data.postId}">
                <button onclick="editPost('${res.data.postId}')">
                  ìˆ˜ì •
                </button>
              </div>
            `;
            postContainerDetail.innerHTML = editInput;
          })
          .then((data) => {
            // console.log(data);
          });
      };

      const deleteBtn = () => {
        console.log("delete!");
      };
    </script>
    <script src="/static/js/paper.js"></script>
    <script src="/static/js/snow.js"></script>
  </body>
</html>
